<link rel="import" href="../../bower_components/paper-input/paper-input.html">

<dom-module id="json-schema-form">
	<template>

	</template>

	<script>
		(function () {
			'use strict';
			var that = this;
			var fillElement = function (element, schema, value, elementFactory) {
				element.schema = schema;
				element.elementFactory = elementFactory
				element.value = value
			};
			Polymer({
				is: 'json-schema-form',
				properties: {
					elementFactory: {
						type: Object,
						value: {
							object: function (schema, value, elementFactory) {
								var jsonSchemaObject = document.createElement('json-schema-object');
								fillElement(jsonSchemaObject, schema, value, elementFactory);
								return jsonSchemaObject;
							},
							array: function (schema, value, elementFactory) {
								var jsonSchemaArray = document.createElement('json-schema-array');
								fillElement(jsonSchemaArray, schema, value, elementFactory);
								return jsonSchemaArray;
							},
							string: function (schema, value, elementFactory) {
								var paperInput = document.createElement('paper-input');
								paperInput.value = value;
								paperInput.label = schema.title;
								return paperInput;
							},
						},
						notify: true
					}, schema: {
						type: Object,
						value: null,
						notify: false,
						readOnly: false,
						observer: '_schemaChanged'
					}, value: {
						type: Object,
						value: null,
						notify: true,
						observer: '_valueChanged'
					}
				},
				_schemaChanged: function (newSchema, oldSchema) {
					var element = this.elementFactory[this.schema.type](newSchema, this.value, this.elementFactory);
					this.appendChild(element);
				},
				_valueChanged: function (newSchema, oldSchema) {
					
				},
			});
		})();
	</script>
</dom-module>

<dom-module id="json-schema-object">
	<template>
	</template>

	<script>
		(function () {
			'use strict';
			var onSchemaChanged = function () {
				if (this.elementFactory) {
					var that = this;
					var keys = Object.keys(this.schema.properties);
					keys.forEach(function (key) {
						var property = that.schema.properties[key];
						var element = that.elementFactory[property.type](property, (that.value && that.value[key]) || Object.assign({}, property.default), that.elementFactory);
						that.appendChild(element);
					});
				}
			};
			Polymer({
				is: 'json-schema-object',
				properties: {
					elementFactory: {
						type: Object,
						notify: false,
						readOnly: false,
						observer: '_elementFactoryChanged'
					}, schema: {
						type: Object,
						notify: false,
						readOnly: false,
						observer: '_schemaChanged'
					}, value: {
						value: null,
						notify: true,
						readOnly: false,
					}
				},
				_schemaChanged: function (newSchema, oldSchema) {
					onSchemaChanged.call(this);
				},
				_elementFactoryChanged: function (newElementFactory, oldElementFactory) {
					if (newElementFactory && this.schema) onSchemaChanged.call(this);
				}
			});
		})();
	</script>
</dom-module>

<dom-module id="json-schema-array">
	<template>
	</template>

	<script>
		(function () {
			'use strict';
			Polymer({
				is: 'json-schema-array',
				properties: {
					elementFactory: {
						type: Object,
						notify: false,
						readOnly: false
					}, schema: {
						type: Object,
						notify: true
					}, value: {
						value: null,
						notify: true,
					}
				},
				ready: function () {
					var that = this;
					var keys = Object.key(this.schema.properties);
					keys.forEach(function (key) {
						var property = that.schema.properties[key];
						var element = that.elementFactory[property.type](property, that.value[key], that.elementFactory);
						that.appendChild(element);
					});
				}
			});
		})();
	</script>
</dom-module>